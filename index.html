<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Buzzy Games</title>
<meta name="theme-color" content="#0a0a0a" />
<style>
  :root{
    /* Black & white with a hint of orange */
    --bg:#0a0a0a;         /* page background (near-black) */
    --surface:#101010;    /* surfaces (cards/nav) */
    --card:#141414;       /* card fill */
    --muted:#cfcfcf;      /* muted text */
    --text:#f5f5f5;       /* main text */
    --accent:#ff7a18;     /* subtle orange accent */
    --border:rgba(255,255,255,.08);
    --shadow:0 16px 40px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:radial-gradient(1200px 800px at 70% -10%, rgba(255,122,24,.08), transparent 50%), var(--bg);
    color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  }
  a{color:inherit;text-decoration:none}

  /* Top Nav */
  .nav{
    position:sticky;top:0;z-index:50;
    backdrop-filter:saturate(130%) blur(10px);
    background:color-mix(in srgb, var(--surface) 90%, transparent);
    border-bottom:1px solid var(--border);
  }
  .nav-inner{
    max-width:1240px;margin:0 auto;display:flex;align-items:center;gap:14px;padding:14px 16px;
  }
  .brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.25px}
  .dot{
    width:12px;height:12px;border-radius:999px;
    background:var(--accent);
    box-shadow:0 0 0 4px rgba(255,122,24,.15), 0 0 20px rgba(255,122,24,.35);
  }
  .spacer{flex:1}
  .pill{
    display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border);border-radius:999px;
    padding:8px 12px;background:var(--surface);font-size:13px;color:var(--muted)
  }
  .tabs{display:flex;gap:8px}
  .tab-btn{
    border:1px solid var(--border);background:var(--surface);color:var(--text);
    padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:700;font-size:13px;opacity:.9
  }
  .tab-btn.active{
    background:linear-gradient(180deg, color-mix(in srgb, var(--accent) 35%, #000 65%), var(--surface));
    border-color:color-mix(in srgb, var(--accent) 40%, var(--border));
  }

  .wrap{max-width:1240px;margin:20px auto;padding:0 16px}
  .section{display:none}
  .section.active{display:block}

  /* Toolbar */
  .toolbar{display:flex;gap:10px;align-items:center;margin:10px 0 18px}
  .search{
    flex:1;display:flex;align-items:center;gap:10px;background:var(--surface);border:1px solid var(--border);
    padding:12px 14px;border-radius:14px;
  }
  .search input{flex:1;background:transparent;border:0;outline:0;color:var(--text);font-size:15px}

  /* Grid ‚Äî bigger cards */
  .grid{
    display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px;
  }
  .card{
    position:relative;border:1px solid var(--border);background:var(--card);
    border-radius:18px;overflow:hidden;box-shadow:var(--shadow);
    transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
  }
  .card:hover{
    transform:translateY(-3px);
    border-color:color-mix(in srgb, var(--accent) 35%, var(--border));
    box-shadow:0 20px 50px rgba(0,0,0,.45);
  }
  .cover{
    aspect-ratio:16/9;background:#0f0f0f;display:block;width:100%;object-fit:cover
  }
  /* Play overlay on hover */
  .play-overlay{
    position:absolute;inset:0;display:grid;place-items:center;
    background:linear-gradient(180deg, transparent, rgba(0,0,0,.45) 60%);
    opacity:0;transition:opacity .18s ease;
  }
  .card:hover .play-overlay{opacity:1}
  .play-btn{
    background:var(--accent);color:#000;font-weight:900;border:0;border-radius:999px;padding:10px 16px;cursor:pointer
  }
  .card-body{padding:12px 14px}
  .name{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .meta{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
  .badge{
    font-size:12px;border:1px solid var(--border);background:#0f0f0f;padding:6px 10px;border-radius:999px;opacity:.95;color:var(--muted)
  }
  .badge.orange{border-color:color-mix(in srgb, var(--accent) 40%, var(--border)); color:var(--text)}
  .empty{opacity:.75;text-align:center;padding:42px 0;color:var(--muted)}

  /* Drops */
  .drop{
    border:1px solid var(--border);background:var(--surface);border-radius:16px;
    padding:14px 16px;display:flex;gap:16px;align-items:center
  }
  .drop .title{font-weight:900}
  .countdown{margin-left:auto;font-variant-numeric:tabular-nums;font-weight:800;color:var(--accent)}

  /* Analytics */
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
  .stat{
    border:1px solid var(--border);background:var(--surface);border-radius:18px;padding:16px
  }
  .stat h3{margin:0 0 8px 0;font-size:14px;color:var(--muted)}
  .list{display:grid;gap:8px;margin-top:8px}
  .row{display:flex;justify-content:space-between;gap:10px}
  .mono{font-variant-numeric:tabular-nums}

  /* Admin */
  .admin-wrap{display:grid;gap:16px}
  .panel{border:1px solid var(--border);background:var(--surface);border-radius:18px;padding:16px}
  .panel h3{margin-top:0}
  .field{display:grid;gap:6px;margin:8px 0}
  .field input{background:#0f0f0f;border:1px solid var(--border);border-radius:12px;padding:12px;color:var(--text)}
  .btn{
    background:var(--accent);color:#000;border:0;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer
  }
  .btn.secondary{background:#0f0f0f;border:1px solid var(--border);color:var(--text);font-weight:700}

  /* Modals */
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.6)}
  .modal.show{display:flex}
  .modal-card{
    width:min(560px,92vw);border:1px solid var(--border);background:var(--surface);border-radius:20px;box-shadow:var(--shadow);padding:18px
  }
  .modal-card h2{margin-top:0}
  .code-input{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#0f0f0f;color:var(--text)}
  .small{font-size:12px;color:var(--muted)}
  @media (max-width:640px){ .grid{grid-template-columns:repeat(auto-fill,minmax(200px,1fr));} }
</style>
</head>
<body>
  <header class="nav">
    <div class="nav-inner">
      <div class="brand"><span class="dot"></span> <span>Buzzy Games</span></div>
      <div class="spacer"></div>
      <div class="pill" title="People online across the site">
        <span>Online</span> <strong id="onlineCount">0</strong>
      </div>
      <div class="tabs" id="tabs">
        <button class="tab-btn active" data-tab="browse">Browse</button>
        <button class="tab-btn" data-tab="drops">Drops</button>
        <button class="tab-btn" data-tab="analytics">Analytics</button>
        <button class="tab-btn" id="adminTab" style="display:none" data-tab="admin">Admin</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Browse -->
    <section id="browse" class="section active">
      <div class="toolbar">
        <div class="search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2" opacity=".7"/></svg>
          <input id="searchInput" placeholder="Search games‚Ä¶" />
        </div>
        <button class="btn secondary" id="unlockBtn" title="Enter access code to unlock Admin">Unlock</button>
      </div>
      <div id="gameGrid" class="grid"></div>
      <div id="emptyMsg" class="empty" style="display:none">No games found.</div>
    </section>

    <!-- Drops -->
    <section id="drops" class="section">
      <div id="dropsList" class="list"></div>
      <div id="dropsEmpty" class="empty" style="display:none">No upcoming drops yet.</div>
    </section>

    <!-- Analytics -->
    <section id="analytics" class="section">
      <div class="cards">
        <div class="stat">
          <h3>Most Played ‚Äî This Month</h3>
          <div id="monthTopList" class="list"></div>
        </div>
        <div class="stat">
          <h3>Most Played ‚Äî All Time</h3>
          <div id="allTimeList" class="list"></div>
        </div>
        <div class="stat">
          <h3>Totals</h3>
          <div class="list">
            <div class="row"><span>Total Games</span><strong class="mono" id="totalGames">0</strong></div>
            <div class="row"><span>Total Plays (All Time)</span><strong class="mono" id="totalPlays">0</strong></div>
            <div class="row"><span>Current Online</span><strong class="mono" id="onlineCount2">0</strong></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin -->
    <section id="admin" class="section">
      <div id="adminGate" class="panel" style="display:none">
        <h3>Admin Access</h3>
        <p class="small">Enter the access code to manage games and drops.</p>
        <input id="adminCodeInput" class="code-input" placeholder="Enter code‚Ä¶" />
        <div style="margin-top:10px;display:flex;gap:8px">
          <button class="btn" id="adminUnlockConfirm">Unlock</button>
          <button class="btn secondary" id="adminUnlockCancel">Cancel</button>
        </div>
      </div>

      <div id="adminWrap" class="admin-wrap" style="display:none">
        <div class="panel">
          <h3>Add a Game</h3>
          <div class="field"><label>Name</label><input id="gName" placeholder="e.g., Drift Racer Pro" /></div>
          <div class="field"><label>Cover URL</label><input id="gCover" placeholder="https://‚Ä¶" /></div>
          <div class="field"><label>Game URL (embeddable)</label><input id="gUrl" placeholder="https://‚Ä¶ (the game will be iframed)" /></div>
          <button class="btn" id="addGameBtn">Add Game</button>
        </div>

        <div class="panel">
          <h3>Create a Game Drop</h3>
          <div class="field"><label>Title</label><input id="dTitle" placeholder="e.g., Halloween Mega Drop" /></div>
          <div class="field"><label>Attach to Game (optional)</label><input id="dGameId" placeholder="Paste Game ID (or leave blank)" /></div>
          <div class="field"><label>Cover Image URL (optional)</label><input id="dCover" placeholder="https://‚Ä¶" /></div>
          <div class="field"><label>Start Time</label><input id="dStart" type="datetime-local" /></div>
          <div class="field"><label>End Time (optional)</label><input id="dEnd" type="datetime-local" /></div>
          <button class="btn" id="createDropBtn">Create Drop</button>
        </div>

        <div class="panel">
          <h3>Games (Manage)</h3>
          <div id="adminGames" class="list"></div>
        </div>

        <div class="panel">
          <h3>Drops (Manage)</h3>
          <div id="adminDrops" class="list"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Last day of month popup -->
  <div id="eomModal" class="modal">
    <div class="modal-card">
      <h2>üèÜ Most Played This Month</h2>
      <div id="eomContent">Crunching the numbers‚Ä¶</div>
      <div style="margin-top:14px;text-align:right">
        <button class="btn secondary" onclick="document.getElementById('eomModal').classList.remove('show')">Close</button>
      </div>
    </div>
  </div>

  <!-- Admin unlock modal -->
  <div id="unlockModal" class="modal">
    <div class="modal-card">
      <h2>Enter Access Code</h2>
      <input id="unlockInput" class="code-input" placeholder="Enter code‚Ä¶" />
      <div style="margin-top:14px; display:flex; gap:8px; justify-content:flex-end">
        <button class="btn secondary" onclick="toggleUnlock(false)">Cancel</button>
        <button class="btn" id="unlockConfirm">Unlock</button>
      </div>
      <p class="small" style="margin-top:8px">Hint: admin code ends with <strong>2025</strong>.</p>
    </div>
  </div>

<script type="module">
  /* Firebase */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-analytics.js";
  import {
    getFirestore, collection, addDoc, setDoc, doc, getDoc, getDocs,
    updateDoc, deleteDoc, onSnapshot, query, where, orderBy, limit,
    serverTimestamp, increment
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBI7amPbyDP4cgtWvoooGz9JQAPXJEpCaE",
    authDomain: "buzzy-games.firebaseapp.com",
    projectId: "buzzy-games",
    storageBucket: "buzzy-games.firebasestorage.app",
    messagingSenderId: "1019717198169",
    appId: "1:1019717198169:web:8bff09527755e2672c6c48",
    measurementId: "G-JPPBF2PHDJ"
  };

  const app = initializeApp(firebaseConfig);
  try { getAnalytics(app); } catch(e){}
  const db = getFirestore(app);

  /* Utils */
  const $ = s => document.querySelector(s);
  const el = (tag, attrs={}, children=[]) => {
    const n = document.createElement(tag);
    Object.entries(attrs).forEach(([k,v]) => (k==='class'? n.className=v : n.setAttribute(k,v)));
    children.forEach(c => n.appendChild(typeof c === 'string' ? document.createTextNode(c) : c));
    return n;
  };
  const monthKey = (d=new Date()) => `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
  const lastDayOfMonth = (d=new Date()) => new Date(d.getFullYear(), d.getMonth()+1, 0).getDate();

  /* Session ID + site presence */
  const sessionId = (() => {
    let id = localStorage.getItem('bz_session');
    if(!id){ id = crypto.getRandomValues(new Uint32Array(4)).join('-'); localStorage.setItem('bz_session', id); }
    return id;
  })();

  async function startSitePresence(){
    const ref = doc(db, 'sitePresence', sessionId);
    await setDoc(ref, { lastSeen: serverTimestamp() }, { merge:true });
    setInterval(async () => {
      await setDoc(ref, { lastSeen: serverTimestamp() }, { merge:true });
    }, 25000);

    const threshold = new Date(Date.now() - 60000); // last 60s
    const qy = query(collection(db, 'sitePresence'), where('lastSeen','>=', threshold));
    onSnapshot(qy, snap => {
      const count = snap.size;
      $('#onlineCount').textContent = count;
      $('#onlineCount2').textContent = count;
    });
  }

  /* Tabs */
  const tabsEl = $('#tabs');
  const sections = document.querySelectorAll('.section');
  tabsEl.addEventListener('click', e => {
    const btn = e.target.closest('.tab-btn');
    if(!btn) return;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b===btn));
    const tab = btn.getAttribute('data-tab');
    sections.forEach(s => s.classList.toggle('active', s.id === tab));
    if(tab === 'analytics'){ loadAnalytics(); }
  });

  /* Admin unlock */
  const ADMIN_CODE = 'buzzygamesadmin2025';
  function isAdmin(){ return localStorage.getItem('bz_admin') === '1'; }
  function setAdmin(v){
    if(v){ localStorage.setItem('bz_admin','1'); } else { localStorage.removeItem('bz_admin'); }
    $('#adminTab').style.display = v ? '' : 'none';
    if(v){ $('#adminGate').style.display='none'; $('#adminWrap').style.display='grid'; }
  }
  function toggleUnlock(show){
    $('#unlockModal').classList.toggle('show', !!show);
    if(show){ setTimeout(()=>$('#unlockInput').focus(),50); }
  }
  $('#unlockBtn').addEventListener('click', ()=>toggleUnlock(true));
  $('#unlockConfirm').addEventListener('click', ()=>{
    const code = $('#unlockInput').value.trim();
    if(code === ADMIN_CODE){ setAdmin(true); toggleUnlock(false); $('#adminTab').click(); }
    else { alert('Incorrect code.'); }
  });
  if(isAdmin()) setAdmin(true);
  document.querySelector('[data-tab="admin"]').addEventListener?.('click', ()=>{
    if(!isAdmin()){
      $('#adminGate').style.display='block';
      $('#adminWrap').style.display='none';
    } else {
      $('#adminGate').style.display='none';
      $('#adminWrap').style.display='grid';
    }
  });
  $('#adminUnlockConfirm')?.addEventListener('click', ()=>{
    const code = $('#adminCodeInput').value.trim();
    if(code === ADMIN_CODE){ setAdmin(true); $('#adminGate').style.display='none'; $('#adminWrap').style.display='grid'; }
    else alert('Incorrect code.');
  });
  $('#adminUnlockCancel')?.addEventListener('click', ()=>{ $('#adminTab').click(); });

  /* Browse */
  let allGames = [];
  const grid = $('#gameGrid'); const emptyMsg = $('#emptyMsg');

  function renderGames(list){
    grid.innerHTML = '';
    if(!list.length){ emptyMsg.style.display='block'; return; }
    emptyMsg.style.display='none';
    list.forEach(g=>{
      const card = el('a', { class:'card', href:`embed.html?id=${g.id}`, title:g.name });
      const img = el('img', { class:'cover', src:g.coverUrl || '', alt:g.name, onerror:"this.src='';this.style.background='#111'" });
      const overlay = el('div', { class:'play-overlay' }, [ el('button', { class:'play-btn' }, ['Play']) ]);
      const body = el('div', { class:'card-body' }, [
        el('div', { class:'name' }, [g.name || 'Untitled']),
        el('div', { class:'meta' }, [
          el('span', { class:'badge' }, [`Plays: ${g.plays ?? 0}`]),
          el('span', { class:'badge orange' }, [`Playing: ${g.currentPlayers ?? 0}`]),
        ])
      ]);
      card.append(img, overlay, body);
      grid.appendChild(card);
    });
  }

  function applySearch(){
    const q = $('#searchInput').value.toLowerCase().trim();
    if(!q) return renderGames(allGames);
    renderGames(allGames.filter(g => (g.name||'').toLowerCase().includes(q)));
  }
  $('#searchInput').addEventListener('input', applySearch);

  const gamesRef = collection(db, 'games');
  const gamesQuery = query(gamesRef, orderBy('name'));
  onSnapshot(gamesQuery, snap=>{
    allGames = snap.docs.map(d => ({ id:d.id, ...d.data() }));
    renderGames(allGames);
    $('#totalGames').textContent = allGames.length;
    const total = allGames.reduce((s,g)=> s + (Number(g.plays)||0), 0);
    $('#totalPlays').textContent = total.toLocaleString();
    if(isAdmin()) renderAdminGames(allGames);
  });

  /* Drops */
  const dropsRef = collection(db, 'drops');
  const dropsQuery = query(dropsRef, orderBy('startAt', 'asc'));
  let dropIntervals = [];
  function clearDropIntervals(){ dropIntervals.forEach(id=>clearInterval(id)); dropIntervals=[]; }

  function fmtCountdown(ms){
    if(ms <= 0) return 'LIVE';
    const s = Math.floor(ms/1000);
    const d = Math.floor(s/86400);
    const h = Math.floor((s%86400)/3600);
    const m = Math.floor((s%3600)/60);
    const ss = s%60;
    return `${d}d ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
  }

  function renderDrops(docs, intoList, isAdmin=false){
    intoList.innerHTML = '';
    if(!docs.length){
      if(intoList.id==='dropsList') $('#dropsEmpty').style.display='block';
      return;
    }
    $('#dropsEmpty').style.display='none';
    docs.forEach(d=>{
      const data = d.data(); const id = d.id;
      const row = el('div', { class:'drop' });
      if(data.coverUrl){
        const img = el('img', { src:data.coverUrl, alt:data.title, style:'width:88px;height:56px;object-fit:cover;border-radius:12px;border:1px solid var(--border)' });
        row.appendChild(img);
      }
      const info = el('div', {}, [
        el('div', { class:'title' }, [data.title || 'Untitled Drop']),
        el('div', { class:'small' }, [ data.gameId ? `Game: ${data.gameId}` : 'General event'])
      ]);
      const cd = el('div', { class:'countdown mono' }, ['‚Ä¶']);
      row.append(info, cd);
      if(isAdmin){
        const del = el('button', { class:'btn secondary', style:'margin-left:10px' }, ['Delete']);
        del.addEventListener('click', async ()=>{ await deleteDoc(doc(db,'drops',id)); });
        row.appendChild(del);
      }
      intoList.appendChild(row);

      const tick = ()=>{
        const now = Date.now();
        const start = data.startAt?.toMillis ? data.startAt.toMillis() : (data.startAt || 0);
        const end = data.endAt?.toMillis ? data.endAt.toMillis() : (data.endAt || null);
        if(now < start) cd.textContent = fmtCountdown(start - now);
        else if(end && now <= end) cd.textContent = 'LIVE';
        else cd.textContent = 'Ended';
      };
      tick();
      const iid = setInterval(tick, 1000);
      dropIntervals.push(iid);
    });
  }

  onSnapshot(dropsQuery, snap=>{
    clearDropIntervals();
    renderDrops(snap.docs, $('#dropsList'));
    if(isAdmin()) renderDrops(snap.docs, $('#adminDrops'), true);
  });

  /* Analytics */
  async function loadAnalytics(){
    const mk = monthKey(new Date());
    const monthQuery = query(collection(db, 'monthlyPlays'), where('month','==', mk), orderBy('count','desc'), limit(10));
    const monthSnap = await getDocs(monthQuery);
    const monthList = $('#monthTopList'); monthList.innerHTML='';
    monthSnap.forEach(d=>{
      const x = d.data();
      monthList.appendChild(el('div',{class:'row'},[
        el('span',{},[x.gameName || x.gameId]),
        el('strong',{class:'mono'},[String(x.count||0)])
      ]));
    });
    if(monthSnap.empty){ monthList.innerHTML = '<div class="small">No plays yet this month.</div>'; }

    const allList = $('#allTimeList'); allList.innerHTML='';
    const allSorted = [...allGames].sort((a,b)=> (b.plays||0)-(a.plays||0)).slice(0,10);
    allSorted.forEach(g=>{
      allList.appendChild(el('div',{class:'row'},[
        el('span',{},[g.name||'Untitled']),
        el('strong',{class:'mono'},[String(g.plays||0)])
      ]));
    });
    if(!allSorted.length){ allList.innerHTML = '<div class="small">No games yet.</div>'; }
  }

  /* End-of-month popup */
  async function maybeShowEOM(){
    const today = new Date();
    if(today.getDate() !== lastDayOfMonth(today)) return;
    const mk = monthKey(today);
    const qy = query(collection(db,'monthlyPlays'), where('month','==',mk), orderBy('count','desc'), limit(1));
    const snap = await getDocs(qy);
    const box = $('#eomContent');
    if(snap.empty){
      box.innerHTML = 'No gameplay recorded this month.';
    } else {
      const top = snap.docs[0].data();
      box.innerHTML = `
        <div style="display:flex; gap:12px; align-items:center">
          ${top.coverUrl ? `<img src="${top.coverUrl}" alt="" style="width:110px;height:68px;object-fit:cover;border-radius:12px;border:1px solid var(--border)"/>` : ''}
          <div>
            <div style="font-weight:900;font-size:18px">${top.gameName || 'Top Game'}</div>
            <div class="small">Plays: <strong>${top.count||0}</strong> in ${mk}</div>
          </div>
        </div>`;
    }
    $('#eomModal').classList.add('show');
  }

  /* Admin actions */
  async function addGame(){
    const name = $('#gName').value.trim();
    const coverUrl = $('#gCover').value.trim();
    const gameUrl = $('#gUrl').value.trim();
    if(!name || !gameUrl){ alert('Name and Game URL are required.'); return; }
    await addDoc(collection(db,'games'), { name, coverUrl, gameUrl, plays:0, currentPlayers:0, createdAt: serverTimestamp() });
    $('#gName').value=''; $('#gCover').value=''; $('#gUrl').value='';
  }
  $('#addGameBtn').addEventListener('click', addGame);

  function renderAdminGames(list){
    const box = $('#adminGames'); box.innerHTML='';
    list.forEach(g=>{
      const row = el('div', { class:'row' }, [
        el('span', {}, [`${g.name} `, el('span',{class:'small'},[`(#${g.id.slice(0,6)})`])]),
        (()=>{ const wrap = el('span'); 
          const open = el('button',{class:'btn secondary',style:'margin-right:8px'},['Open Embed']);
          open.addEventListener('click',()=>{ location.href=`embed.html?id=${g.id}`; });
          const del = el('button',{class:'btn secondary'},['Delete']);
          del.addEventListener('click', async ()=>{ if(confirm('Delete this game?')) await deleteDoc(doc(db,'games',g.id)); });
          wrap.append(open,del); return wrap; })()
      ]);
      box.appendChild(row);
    });
  }

  async function createDrop(){
    const title = $('#dTitle').value.trim();
    const gameId = $('#dGameId').value.trim();
    const coverUrl = $('#dCover').value.trim();
    const startVal = $('#dStart').value;
    if(!title || !startVal){ alert('Title and start time are required.'); return; }
    const endVal = $('#dEnd').value;
    const payload = {
      title, gameId: gameId || null, coverUrl: coverUrl || null,
      startAt: new Date(startVal), endAt: endVal ? new Date(endVal) : null,
      createdAt: serverTimestamp()
    };
    await addDoc(collection(db,'drops'), payload);
    $('#dTitle').value=''; $('#dGameId').value=''; $('#dCover').value='';
    $('#dStart').value=''; $('#dEnd').value='';
  }
  $('#createDropBtn').addEventListener('click', createDrop);

  /* Init */
  startSitePresence();
  maybeShowEOM();
</script>
</body>
</html>
